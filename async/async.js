'use strict';

// async & await
// clear style of using promise (promise chainìœ¼ë¡œ ê¸¸ê²Œ ì—°ë‹¬ì•„ ì‘ì„±ëœ ì½”ë“œë¥¼ ë” ê¹”ë”í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆê²Œ í•´ì¤Œ)
// ë˜í•œ promiseë¥¼ ì¡°ê¸ˆ ë” ê°„ê²°, ê°„í¸í•˜ê³ , ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ê²Œ ë§Œë“¤ì–´ì¤Œ.
// ì¡°ê¸ˆ ë” ê°„í¸í•œ APIë¡œì¨ async/awaitì„ ì‚¬ìš©í•˜ë©´ ë™ê¸°ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒì²˜ëŸ¼ ì‘ì„±í•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤Œ.
// ìƒˆë¡­ê²Œ ì¶”ê°€ëœ ê²ƒì´ ì•„ë‹Œ, ê¸°ì¡´ì— ì¡´ì¬í•˜ëŠ” promise ìœ„ì— ì¡°ê¸ˆ ë” ê°„í¸í•œ APIë¥¼ ì œê³µí•˜ëŠ” Syntatical sugar. (classë„ ê·¸ëŸ° ì˜ˆì‹œì´ì§€.)
// í•˜ì§€ë§Œ, ê·¸ë ‡ë‹¤ê³  ë¬´ì¡°ê±´ promiseëŠ” ë‚˜ì˜ê³ , async/awaitìœ¼ë¡œ ëŒ€ì²´ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ê±´ ì ˆëŒ€ ì•„ë‹˜.
// promiseë¥¼ ìœ ì§€í•´ì•¼ í•˜ëŠ” ê²½ìš°ë„ ìˆê³ , async/awaitìœ¼ë¡œ ë³€í˜•í•´ì•¼ì§€ ì¡°ê¸ˆ ë” ê¹”ë”í•´ì§€ëŠ” ê²½ìš°ê°€ ìˆìŒ.

// 1. async
/*
function fetchUser(){
    // do network request in 10 secs.... (ì‚¬ìš©ìì˜ ë°ì´í„°ë¥¼ ë°±ì—”ë“œì— ìš”ì²­í•´ì„œ ë°›ì•„ì˜¤ëŠ”ë° 10ì´ˆ ì •ë„ ê±¸ë¦¬ëŠ” í•¨ìˆ˜ë¼ê³  ê°€ì •í•´ë³´ì.)
    return 'ellie';
}

const user = fetchUser();
console.log(user);

ì´ë ‡ê²Œ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì½”ë“œë¥¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ì§€ ì•Šìœ¼ë©´
jsì—”ì§„ì€ ë™ê¸°ì ìœ¼ë¡œ ì½”ë“œë¥¼ ì²˜ë¦¬í•˜ê¸° ë•Œë¬¸ì—, ì¦‰ í•œ ì¤„ì´ ëë‚˜ì•¼ì§€
ê·¸ ë‹¤ìŒ ì¤„ë¡œ ë„˜ì–´ê°€ëŠ” ë™ê¸°ì  ì²˜ë¦¬ë¥¼ í•˜ê¸° ë•Œë¬¸ì—
10ì´ˆ ë™ì•ˆ function fetchUser(){} ì—ë§Œ ë¨¸ë¬´ë¥´ê³  ìˆë‹¤ê°€
10ì´ˆ ë’¤ì— ì„±ê³µì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ë©´ ê·¸ì œì„œì•¼
ë‹¤ìŒ ì¤„ë¡œ ë„˜ì–´ê°€ë©´ì„œ 'ellie' ê°€ returnë˜ê³ 
ê·¸ë¦¬ê³  ë‚˜ì„œ userì— í• ë‹¹ë˜ê³  ê·¸ê±°ë¥¼ ì½˜ì†”ì°½ì— ì°ê²Œ ë˜ëŠ”ê±°

ë§Œì•½ console.log(user); ë°‘ì—ì„œë¶€í„°
ì›¹í˜ì´ì§€ì˜ uië¥¼ í‘œì‹œí•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” ì½”ë“œë“¤ì´ ìˆë‹¤ë©´
fetchUser()ì´ ëë‚˜ê¸° ì „ê¹Œì§€ëŠ” ë°ì´í„°(ui)ê°€ ì›¹í˜ì´ì§€ì— í‘œì‹œë˜ì§€ ì•Šìœ¼ë¯€ë¡œ
ì‚¬ìš©ìëŠ” 10ì´ˆ ì •ë„ í…… ë¹ˆ ì›¹í˜ì´ì§€ë§Œ ë³´ê³  ìˆì„ê²ƒ.

ì´ëŸ° ê±¸ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì½”ë“œë“¤ì€ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•´ì¤˜ì•¼ í•œë‹¤ëŠ”ê±°ì—¬!
ì´ê±°ë¥¼ ì§€ë‚œë²ˆì—ëŠ” promiseë¡œ í–ˆì§€.

new Promise(): "ì•¼ ë‚´ê°€ ì–¸ì œ userì˜ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¬ì§€ëŠ” ëª¨ë¥´ê² ì§€ë§Œ, ë‚´ê°€ 'ì•½ì†í• ê²Œ'
ì´ Promiseë¼ëŠ” objectë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©´ ì—¬ê¸°ì— ë‹ˆê°€ then()ì´ë¼ëŠ” ì½œë°±í•¨ìˆ˜ë§Œ ë“±ë¡í•´ë†“ìœ¼ë©´
userì˜ ë°ì´í„°ê°€ ì¤€ë¹„ë˜ëŠ” ëŒ€ë¡œ ë‹ˆê°€ ë“±ë¡í•œ ì½œë°±í•¨ìˆ˜ë¥¼ ë‚´ê°€ ë¶ˆëŸ¬ì¤„ê²Œ" ë¼ê³  ì•½ì†í•˜ëŠ” ê±°ì˜€ì§€?

ì´ë ‡ê²Œ ì§€ë‚œë²ˆì²˜ëŸ¼ promiseë¥¼ ì´ìš©í•˜ì§€ ì•Šê³ ë„ ì¢€ ë” ê°„í¸í•˜ê²Œ ë¹„ë™ê¸°ë¥¼ ì‘ì„±í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.
*/

// í•¨ìˆ˜ì•ì— asyncë¼ëŠ” í‚¤ì›Œë“œë¥¼ ë¶™ì—¬ì£¼ë©´ ë¨. 
// ë²ˆê±°ë¡­ê²Œ promiseë¥¼ ì“°ì§€ ì•Šì•„ë„ ìë™ì ìœ¼ë¡œ í•¨ìˆ˜ì•ˆì— ìˆëŠ” ì½”ë“œë¸”ë¡ë“¤ì´ promiseë¡œ ë³€í™˜ë¨.
async function fetchUser(){
    // do network request in 10 secs.... 
    return 'ellie';
}

const user = fetchUser();
user
.then(console.log);
console.log(user);

// 2. await
function delay(ms){
    return new Promise((resolve, reject) => {
        setTimeout(() => resolve(), ms)
    });
}

async function getApple(){
    await delay(2000);
    /*
    awaitì€ asyncê°€ ë¶™ì€ í•¨ìˆ˜ 'ì•ˆì—ì„œë§Œ' ì“¸ ìˆ˜ ìˆìŒ
    ê·¸ë‹ˆê¹Œ ì—¬ê¸°ì„œ delay(3000); ì„ í˜¸ì¶œí–ˆìœ¼ë©´, 
    ì›ë˜ëŒ€ë¡œë©´ asyncë¥¼ ë¶™ì˜€ìœ¼ë‹ˆ ë¹„ë™ê¸° ì²˜ë¦¬ë˜ì„œ
    jsì—”ì§„ì´ ë°‘ì— return 'ì‚¬ê³¼'ë¡œ ë„˜ì–´ê°ˆí…ë°
    awaitì„ ë¶™ì—¬ì¤Œìœ¼ë¡œì¨ delay(3000);ì´ ëë‚ ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì¤Œ.
    ì¦‰ 3ì´ˆ ê°„ ê¸°ë‹¤ë ¸ë‹¤ê°€ ê·¸ ë‹¤ìŒ ì¤„ì„ ì‹¤í–‰í•¨.
    */

    return 'ğŸ';
    /*
    ê·¸ë‹ˆê¹Œ ê²°êµ­ ì´ê±°ëŠ”
    async function getApple(){
        return delay(3000);
        .then(() => 'ğŸ');
    }
    ì´ë ‡ê²Œ promise chainìœ¼ë¡œ ë§Œë“¤ìˆ˜ë„ ìˆì§€ë§Œ
    ë™ê¸°ì ì¸ ê²ƒì²˜ëŸ¼ ë³´ì´ëŠ” ì½”ë“œë¥¼ ì¨ì„œ ë§Œë“¤ë©´
    'ì•„ delay(3000); ì´ ëë‚ ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤. ê¸°ë‹¤ë ¸ë‹¤ê°€ ì‚¬ê³¼ë¥¼ ë¦¬í„´í•œë‹¤.'
    ì´ë ‡ê²Œ ë” ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆê² ì§€.
    */
}

async function getBanana(){
    await delay(1000);
    return 'ğŸŒ';
}

/*
function pickFruits(){
    return getApple()
    .then((apple) => {
        return getBanana()
        .then((banana) => `${apple} + ${banana}`);
    });
}

pickFruits()
.then((result) => console.log(result));

ì´ê²ƒë„ ë³´ë©´ ì½œë°±ì§€ì˜¥ì˜ ëŠë‚Œê³¼ ë¹„ìŠ·í•˜ì§€ ì•ŠìŒ?
promise chainë„ ë„ˆë¬´ ì¤‘ì²©ì ìœ¼ë¡œ chainingì„ í•˜ê²Œ ë˜ë©´
ì½œë°±ì§€ì˜¥ê³¼ ë¹„ìŠ·í•œ ë¬¸ì œì ì´ ë°œìƒí•¨.
*/

/*
ê·¸ë˜ì„œ ì´ê±°ë¥¼ async/await í‚¤ì›Œë“œë¡œ ê°„ë‹¨í•˜ê²Œ ë§Œë“¤ì–´ë³´ì.

async function pickFruits(){
    const apple = await getApple();
    const banana = await getBanana();
    return `${apple} + ${banana}`;
}

pickFruits()
.then((result) => console.log(result));
ì´ëŸ°ì‹ìœ¼ë¡œ asyncì™€ await ì½”ë“œë¥¼ ì´ìš©í•˜ë©´ ë™ê¸°ì ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ë“¯ì´ ì“¸ ìˆ˜ ìˆì–´ì„œ í¸í•˜ë‹¤.
*/

// ê·¼ë° ìœ„ì—ì„œ awaitë“¤ì€ 1ì´ˆì”© ì‹œê°„ì„ ì†Œëª¨í•´ì„œ ê°ê° apple, bananaì— ëŒ€ì…í•˜ì–ì•„. 2ì´ˆê°€ ê±¸ë¦¬ê² ì§€
// awaitë¥¼ ë³‘ë ¬ë¡œ ì²˜ë¦¬í•˜ë©´ 1ì´ˆ ì•ˆì— í•  ìˆ˜ ìˆë‹¤.
async function pickFruits(){
    const applePromise = getApple(); 
    const bananaPromise = getBanana(); 
    // ì‚¬ê³¼promiseì™€ ë°”ë‚˜ë‚˜promiseë¥¼ ì—¬ê¸°ì„œ ë§Œë“¤ì—ˆê¸° ë•Œë¬¸ì— ë§Œë“¤ìë§ˆì ë°”ë¡œ get~()ì•ˆì— ì½”ë“œë“¤ì´ ì‹¤í–‰ë¨
    // ë³‘ë ¬ì ìœ¼ë¡œ ì‚¬ê³¼ì™€ ë°”ë‚˜ë‚˜ë¥¼ ë™ì‹œì— ë”°ì„œ(ì¦‰ get~()ê°€ ì‹¤í–‰ë˜ì„œ)
    /*
    ì´ë ‡ê²Œ ë™ì‹œë‹¤ë°œì ìœ¼ë¡œ ìˆ˜í–‰ì´ ê°€ëŠ¥í•œ ê²½ìš°ì—ëŠ”
    ì¦‰, getBanana(); ì´ê±¸ í•˜ëŠ”ë° getApple(); ì–˜ê°€ í•„ìš”ì—†ê³ , ê·¸ ë°˜ëŒ€ë„ ë§ˆì°¬ê°€ì§€ê¸° ë•Œë¬¸ì—
    ë³‘ë ¬ì ìœ¼ë¡œ ë‘˜ë‹¤ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ê²½ìš°ëŠ”
    ì´ë ‡ê²Œ ë”ëŸ½ê²Œ ì½”ë“œë¥¼ ì‘ì„±í•˜ì§€ ì•ŠëŠ”ë‹¤!

    promiseì—ì„œ ì œê³µí•˜ëŠ” ìœ ìš©í•œ apië¥¼ ì•„ë˜ì—ì„œ ì‚´í´ë³´ì!
    */

    const apple = await applePromise;
    const banana = await bananaPromise; 
    // ì—¬ê¸°ì„œ ê¸°ë‹¤ë ¸ë‹¤ê°€ í•œë²ˆì— ëŒ€ì…í•´ì„œ

    return `${apple} + ${banana}`;
    // í•œë²ˆì— ì¶œë ¥í•˜ëŠ” ê²ƒ.
}

pickFruits()
.then((result) => console.log(result));

// 3. useful Promise APIs
/* 
Promiseì— ìˆëŠ” all()ì´ë¼ëŠ” APIë¥¼ ì“°ë©´ ëœë‹¤.
ì´ê²ƒì€ promise ë°°ì—´ì„ ì „ë‹¬í•˜ê²Œ ë˜ë©´
ëª¨ë“  promiseë“¤ì´ ë³‘ë ¬ì ìœ¼ë¡œ ë‹¤ ë°›ì„ë•Œê¹Œì§€ ëª¨ì•„ì£¼ëŠ” ê±°ì„.
*/
function pickAllFruits(){
    return Promise.all([getApple(), getBanana()])

    // fruitsì—ëŠ” promise ë°°ì—´ë“¤ì´ ê°ì ì‹¤í–‰ë˜ì„œ ë‚˜ì˜¨ ê²°ê³¼ê°’ì˜ ë°°ì—´, ì¦‰ 'ê³¼ì¼ë“¤ì˜ ë°°ì—´' ì´ ì „ë‹¬ë¨!
    .then((fruits) => fruits.join(' + ')); // joinì€ ë°°ì—´ì„ stringìœ¼ë¡œ ë¬¶ì„ ìˆ˜ ìˆëŠ” array.API
}
pickAllFruits()
.then(console.log);

/*
Promise.race() APIëŠ” 
ë°°ì—´ì— ì „ë‹¬ëœ promiseë“¤ ì¤‘ì—ì„œ ê°€ì¥ ë¨¼ì € ê°’ì„ ë¦¬í„´í•˜ëŠ” ë†ˆ,
ê°€ì¥ ë¹¨ë¦¬ ë¦¬í„´í•˜ëŠ” ë†ˆë§Œ ì „ë‹¬ë˜ëŠ”ê±°ì„.
*/
function pickOnlyOne(){
    return Promise.race([getApple(), getBanana()])
}
pickOnlyOne()
.then(console.log);